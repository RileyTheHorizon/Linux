 Создаём пользователя otusadm и otus:
root@pam:~#  sudo useradd otusadm && sudo useradd otus
 Создаём пользователям пароли:
root@pam:~# echo "otusadm:Otus2022!" | sudo chpasswd
root@pam:~# echo "otus:Otus2022!" | sudo chpasswd
Для примера мы указываем одинаковые пароли для пользователя otus и otusadm

 Создаём группу admin
root@pam:~#  sudo groupadd -f admin
 Добавляем пользователей vagrant,root и otusadm в группу admin
root@pam:~# usermod otusadm -a -G admin && usermod root -a -G admin && usermod vagrant -a -G admin
PS C:\Users\Riley\PAM> ssh otus@192.168.57.10
otus@192.168.57.10's password:
Welcome to Ubuntu 22.04.5 LTS (GNU/Linux 5.15.0-144-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Mon Sep 29 20:05:20 UTC 2025
Далее настроим правило, по которому все пользователи кроме тех, что указаны в группе admin не смогут подключаться в выходные дни:
 Проверим, что пользователи root, vagrant и otusadm есть в группе admin
root@pam:~#  cat /etc/group | grep admin
admin:x:118:otusadm,root,vagrant
Информация о группах и пользователях в них хранится в файле /etc/group, пользователи указываются через запятую. 

Выберем метод PAM-аутентификации, так как у нас используется только ограничение по времени, то было бы логично использовать метод pam_time, однако, данный метод не работает с локальными группами пользователей, и, получается, что использование данного метода добавит нам большое количество однообразных строк с разными пользователями. В текущей ситуации лучше написать небольшой скрипт контроля и использовать модуль pam_exec
 Создадим файл-скрипт /usr/local/bin/login.sh
nano vim /usr/local/bin/login.sh
root@pam:~# nano /usr/local/bin/login.sh

#!/bin/bash
#Первое условие: если день недели суббота или воскресенье
if [ $(date +%a) = "Sat" ] || [ $(date +%a) = "Sun" ]; then
 #Второе условие: входит ли пользователь в группу admin
 if getent group admin | grep -qw "$PAM_USER"; then
        #Если пользователь входит в группу admin, то он может подключиться
        exit 0
      else
        #Иначе ошибка (не сможет подключиться)
        exit 1
    fi
  #Если день не выходной, то подключиться может любой пользователь
  else
    exit 0
fi

В скрипте подписаны все условия. Скрипт работает по принципу: 
Если сегодня суббота или воскресенье, то нужно проверить, входит ли пользователь в группу admin, если не входит — то подключение запрещено. При любых других вариантах подключение разрешено. 
Добавим права на исполнение файла: root@pam:~# chmod +x /usr/local/bin/login.sh
Укажем в файле /etc/pam.d/sshd модуль pam_exec и наш скрипт nano/etc/pam.d/sshd 

PS C:\Users\Riley\PAM> ssh otus@192.168.57.10
otus@192.168.57.10's password:
Permission denied, please try again.
otus@192.168.57.10's password:
PS C:\Users\Riley\PAM> ssh otusadm@192.168.57.10
otusadm@192.168.57.10's password:
Welcome to Ubuntu 22.04.5 LTS (GNU/Linux 5.15.0-144-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Mon Sep 29 20:14:03 UTC 2025

  System load:             0.19
  Usage of /:              4.0% of 38.70GB
  Memory usage:            22%
  Swap usage:              0%
  Processes:               105
  Users logged in:         1
  IPv4 address for enp0s3: 10.0.2.15
  IPv6 address for enp0s3: fd17:625c:f037:2:29:1eff:fe73:1fd5


Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
New release '24.04.3 LTS' available.
Run 'do-release-upgrade' to upgrade to it.



The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.


The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

Last login: Sun Sep 28 00:03:27 2025 from 192.168.57.1
Could not chdir to home directory /home/otusadm: No such file or directory
$ date
Sun Sep 28 00:04:11 UTC 2025


